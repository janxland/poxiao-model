{"ast":null,"code":"/**\n * tdesign v1.9.0\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { defineComponent, ref, reactive, computed, onMounted, watch, createVNode } from 'vue';\nimport props from './props.mjs';\nimport generateBase64Url from '../_common/js/watermark/generateBase64Url.mjs';\nimport randomMovingStyle from '../_common/js/watermark/randomMovingStyle.mjs';\nimport injectStyle from '../_common/js/utils/injectStyle.mjs';\nimport { usePrefixClass } from '../hooks/useConfig.mjs';\nimport { useMutationObserver } from './hooks.mjs';\nimport { useContent } from '../hooks/tnode.mjs';\nimport '../_chunks/dep-7deaa3b9.mjs';\nimport '../_chunks/dep-8dbc9855.mjs';\nimport '../config-provider/useConfig.mjs';\nimport '../_chunks/dep-66473aa9.mjs';\nimport '../_chunks/dep-cb814df4.mjs';\nimport '../_chunks/dep-cd533155.mjs';\nimport '../_chunks/dep-715774e0.mjs';\nimport '../_chunks/dep-5a5a1764.mjs';\nimport '../_chunks/dep-37e3e644.mjs';\nimport '../_chunks/dep-31dc0415.mjs';\nimport '../_chunks/dep-e5142249.mjs';\nimport '../_chunks/dep-c4f80cb4.mjs';\nimport '../_chunks/dep-996b4900.mjs';\nimport '../_chunks/dep-3108c312.mjs';\nimport '../_chunks/dep-93498383.mjs';\nimport '../_chunks/dep-36582a92.mjs';\nimport '../_chunks/dep-a2db6df1.mjs';\nimport '../_chunks/dep-0f89a1dd.mjs';\nimport '../_chunks/dep-2adf18a2.mjs';\nimport '../_chunks/dep-ab439391.mjs';\nimport '../_chunks/dep-60d62610.mjs';\nimport '../_chunks/dep-d4da440a.mjs';\nimport '../_chunks/dep-013382c3.mjs';\nimport '../_chunks/dep-ca764006.mjs';\nimport '../_chunks/dep-2ee9d497.mjs';\nimport '../_chunks/dep-c545db54.mjs';\nimport '../_chunks/dep-3f15cb30.mjs';\nimport '../_chunks/dep-fd2b6c64.mjs';\nimport '../_chunks/dep-30b3f256.mjs';\nimport '../_chunks/dep-b3734774.mjs';\nimport '../_chunks/dep-a4a3ac25.mjs';\nimport '../_chunks/dep-6861d388.mjs';\nimport '../_chunks/dep-396d852b.mjs';\nimport '../_chunks/dep-8a3fd140.mjs';\nimport '../_chunks/dep-5db0da5c.mjs';\nimport '../_common/js/global-config/default-config.mjs';\nimport '../_common/js/global-config/locale/zh_CN.mjs';\nimport '../_chunks/dep-bf19d9ba.mjs';\nimport '../_chunks/dep-6963a882.mjs';\nimport '../config-provider/type.mjs';\nimport '../_chunks/dep-807e1747.mjs';\nimport '../_chunks/dep-f8909853.mjs';\nimport '../_chunks/dep-67e59a11.mjs';\nimport '../_chunks/dep-10024af3.mjs';\nimport '../_chunks/dep-d00e2e04.mjs';\nimport '../_chunks/dep-ec2f76cc.mjs';\nimport '../_chunks/dep-96484611.mjs';\nimport '../_chunks/dep-bd7cd061.mjs';\nimport '../utils/render-tnode.mjs';\nimport '../_chunks/dep-60ee423b.mjs';\nvar _Watermark = defineComponent({\n  name: \"TWatermark\",\n  props: props,\n  setup: function setup(props2) {\n    var backgroundImage = ref(\"\");\n    var watermarkRef = ref();\n    var watermarkContentRef = ref();\n    var parent = ref();\n    var offset = reactive(props2.offset || []);\n    var gapX = computed(function () {\n      return props2.movable ? 0 : props2.x;\n    });\n    var gapY = computed(function () {\n      return props2.movable ? 0 : props2.y;\n    });\n    var rotate = computed(function () {\n      return props2.movable ? 0 : props2.rotate;\n    });\n    var backgroundRepeat = computed(function () {\n      if (props2.movable) {\n        return \"no-repeat\";\n      }\n      return props2.isRepeat ? \"repeat\" : \"no-repeat\";\n    });\n    var offsetLeft = computed(function () {\n      return offset[0] || gapX.value / 2;\n    });\n    var offsetTop = computed(function () {\n      return offset[1] || gapY.value / 2;\n    });\n    var bgImageOptions = computed(function () {\n      return {\n        width: props2.width,\n        height: props2.height,\n        rotate: rotate.value,\n        lineSpace: props2.lineSpace,\n        alpha: props2.alpha,\n        gapX: gapX.value,\n        gapY: gapY.value,\n        watermarkContent: props2.watermarkContent,\n        offsetLeft: offsetLeft.value,\n        offsetTop: offsetTop.value\n      };\n    });\n    var injectWaterMark = function injectWaterMark() {\n      generateBase64Url(bgImageOptions.value, function (base64Url) {\n        backgroundImage.value = base64Url;\n      });\n      var keyframesStyle = randomMovingStyle();\n      injectStyle(keyframesStyle);\n    };\n    onMounted(function () {\n      injectWaterMark();\n      parent.value = watermarkRef.value.parentElement;\n      useMutationObserver(parent.value, function (mutations) {\n        if (props2.removable) return;\n        mutations.forEach(function (mutation) {\n          if (mutation.type === \"childList\") {\n            var removeNodes = mutation.removedNodes;\n            removeNodes.forEach(function (node) {\n              var element = node;\n              if (element === watermarkRef.value) {\n                parent.value.appendChild(element);\n              }\n              if (element === watermarkContentRef.value) {\n                watermarkRef.value.appendChild(element);\n              }\n            });\n          }\n        });\n      }, {\n        attributes: true,\n        childList: true,\n        characterData: true,\n        subtree: true\n      });\n    });\n    watch(function () {\n      return props2.watermarkContent;\n    }, injectWaterMark, {\n      deep: true\n    });\n    return {\n      gapX: gapX,\n      gapY: gapY,\n      backgroundRepeat: backgroundRepeat,\n      backgroundImage: backgroundImage,\n      watermarkRef: watermarkRef,\n      watermarkContentRef: watermarkContentRef,\n      bgImageOptions: bgImageOptions\n    };\n  },\n  render: function render() {\n    var COMPONENT_NAME = usePrefixClass(\"watermark\");\n    var renderContent = useContent();\n    return createVNode(\"div\", {\n      \"style\": {\n        position: \"relative\",\n        overflow: \"hidden\",\n        width: \"100%\"\n      },\n      \"class\": COMPONENT_NAME.value,\n      \"ref\": \"watermarkRef\"\n    }, [renderContent(\"default\", \"content\"), createVNode(\"div\", {\n      \"ref\": \"watermarkContentRef\",\n      \"style\": {\n        zIndex: this.zIndex,\n        position: \"absolute\",\n        left: 0,\n        right: 0,\n        top: 0,\n        bottom: 0,\n        width: \"100%\",\n        height: \"100%\",\n        backgroundSize: \"\".concat(this.gapX + this.width, \"px\"),\n        pointerEvents: \"none\",\n        backgroundRepeat: this.backgroundRepeat,\n        backgroundImage: \"url('\".concat(this.backgroundImage, \"')\"),\n        animation: this.movable ? \"watermark infinite \".concat(this.moveInterval * 4 / 60, \"s\") : \"none\"\n      }\n    }, null)]);\n  }\n});\nexport { _Watermark as default };","map":{"version":3,"names":["_Watermark","defineComponent","name","props","setup","props2","backgroundImage","ref","watermarkRef","watermarkContentRef","parent","offset","reactive","gapX","computed","movable","x","gapY","y","rotate","backgroundRepeat","isRepeat","offsetLeft","value","offsetTop","bgImageOptions","width","height","lineSpace","alpha","watermarkContent","injectWaterMark","generateBase64Url","base64Url","keyframesStyle","randomMovingStyle","injectStyle","onMounted","parentElement","useMutationObserver","mutations","removable","forEach","mutation","type","removeNodes","removedNodes","node","element","appendChild","attributes","childList","characterData","subtree","watch","deep","render","COMPONENT_NAME","usePrefixClass","renderContent","useContent","createVNode","position","overflow","zIndex","left","right","top","bottom","backgroundSize","concat","pointerEvents","animation","moveInterval"],"sources":["../../src/watermark/watermark.tsx"],"sourcesContent":["import { computed, onMounted, defineComponent, watch, ref, reactive } from 'vue';\nimport props from './props';\nimport generateBase64Url from '../_common/js/watermark/generateBase64Url';\nimport randomMovingStyle from '../_common/js/watermark/randomMovingStyle';\nimport injectStyle from '../_common/js/utils/injectStyle';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useMutationObserver } from './hooks';\nimport { useContent } from '../hooks/tnode';\n\nexport default defineComponent({\n  name: 'TWatermark',\n  props,\n  setup(props) {\n    const backgroundImage = ref('');\n    const watermarkRef = ref<HTMLElement>();\n    const watermarkContentRef = ref<HTMLElement>();\n    const parent = ref<HTMLElement>();\n\n    const offset = reactive(props.offset || []);\n\n    const gapX = computed(() => {\n      return props.movable ? 0 : props.x;\n    });\n\n    const gapY = computed(() => {\n      return props.movable ? 0 : props.y;\n    });\n\n    const rotate = computed(() => {\n      return props.movable ? 0 : props.rotate;\n    });\n\n    const backgroundRepeat = computed(() => {\n      if (props.movable) {\n        return 'no-repeat';\n      }\n      return props.isRepeat ? 'repeat' : 'no-repeat';\n    });\n\n    const offsetLeft = computed(() => {\n      return offset[0] || gapX.value / 2;\n    });\n\n    const offsetTop = computed(() => {\n      return offset[1] || gapY.value / 2;\n    });\n\n    const bgImageOptions = computed(() => ({\n      width: props.width,\n      height: props.height,\n      rotate: rotate.value,\n      lineSpace: props.lineSpace,\n      alpha: props.alpha,\n      gapX: gapX.value,\n      gapY: gapY.value,\n      watermarkContent: props.watermarkContent,\n      offsetLeft: offsetLeft.value,\n      offsetTop: offsetTop.value,\n    }));\n\n    const injectWaterMark = () => {\n      generateBase64Url(bgImageOptions.value, (base64Url) => {\n        backgroundImage.value = base64Url;\n      });\n      const keyframesStyle = randomMovingStyle();\n      injectStyle(keyframesStyle);\n    };\n\n    onMounted(() => {\n      injectWaterMark();\n      parent.value = watermarkRef.value.parentElement;\n      useMutationObserver(\n        parent.value,\n        (mutations) => {\n          if (props.removable) return;\n          mutations.forEach((mutation) => {\n            if (mutation.type === 'childList') {\n              const removeNodes = mutation.removedNodes;\n              removeNodes.forEach((node) => {\n                const element = node as HTMLElement;\n                if (element === watermarkRef.value) {\n                  parent.value.appendChild(element);\n                }\n                if (element === watermarkContentRef.value) {\n                  watermarkRef.value.appendChild(element);\n                }\n              });\n            }\n          });\n        },\n        {\n          attributes: true,\n          childList: true,\n          characterData: true,\n          subtree: true,\n        },\n      );\n    });\n\n    watch(() => props.watermarkContent, injectWaterMark, { deep: true });\n\n    return {\n      gapX,\n      gapY,\n      backgroundRepeat,\n      backgroundImage,\n      watermarkRef,\n      watermarkContentRef,\n      bgImageOptions,\n    };\n  },\n\n  render() {\n    const COMPONENT_NAME = usePrefixClass('watermark');\n    const renderContent = useContent();\n\n    return (\n      <div\n        style={{ position: 'relative', overflow: 'hidden', width: '100%' }}\n        class={COMPONENT_NAME.value}\n        ref=\"watermarkRef\"\n      >\n        {renderContent('default', 'content')}\n        <div\n          ref=\"watermarkContentRef\"\n          style={{\n            zIndex: this.zIndex,\n            position: 'absolute',\n            left: 0,\n            right: 0,\n            top: 0,\n            bottom: 0,\n            width: '100%',\n            height: '100%',\n            backgroundSize: `${this.gapX + this.width}px`,\n            pointerEvents: 'none',\n            backgroundRepeat: this.backgroundRepeat,\n            backgroundImage: `url('${this.backgroundImage}')`,\n            animation: this.movable ? `watermark infinite ${(this.moveInterval * 4) / 60}s` : 'none',\n          }}\n        />\n      </div>\n    );\n  },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}