{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n/**\n * tdesign v1.9.3\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { _ as _defineProperty } from '../_chunks/dep-a5dfe884.mjs';\nimport { _ as _typeof } from '../_chunks/dep-d33c5d88.mjs';\nimport { toRefs, ref, computed } from 'vue';\nimport { i as isObject_1 } from '../_chunks/dep-62ad5a36.mjs';\nimport { i as isFunction_1 } from '../_chunks/dep-6e7655db.mjs';\nimport { useFormDisabled } from '../form/hooks.mjs';\nimport '../_chunks/dep-437d10c6.mjs';\nimport '../_chunks/dep-6ad32365.mjs';\nimport '../_chunks/dep-f76ec896.mjs';\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nvar MAX_POPUP_WIDTH = 1e3;\nvar RESERVE_WIDTH = 0;\nfunction useOverlayInnerStyle(props) {\n  var _toRefs = toRefs(props),\n    popupProps = _toRefs.popupProps,\n    autoWidth = _toRefs.autoWidth;\n  var innerPopupVisible = ref(false);\n  var disable = useFormDisabled();\n  var matchWidthFunc = function matchWidthFunc(triggerElement, popupElement) {\n    var SCROLLBAR_WIDTH = popupElement.scrollHeight > popupElement.offsetHeight ? RESERVE_WIDTH : 0;\n    var width = popupElement.offsetWidth + SCROLLBAR_WIDTH >= triggerElement.offsetWidth ? popupElement.offsetWidth : triggerElement.offsetWidth;\n    var otherOverlayInnerStyle = {};\n    if (popupProps.value && _typeof(popupProps.value.overlayInnerStyle) === \"object\" && !popupProps.value.overlayInnerStyle.width) {\n      otherOverlayInnerStyle = popupProps.value.overlayInnerStyle;\n    }\n    return _objectSpread({\n      width: \"\".concat(Math.min(width, MAX_POPUP_WIDTH), \"px\")\n    }, otherOverlayInnerStyle);\n  };\n  var onInnerPopupVisibleChange = function onInnerPopupVisibleChange(visible, ctx) {\n    if (disable.value || props.readonly) return;\n    var newVisible = ctx.trigger === \"trigger-element-click\" && props.allowInput ? true : visible;\n    if (props.popupVisible !== newVisible) {\n      var _props$onPopupVisible;\n      innerPopupVisible.value = newVisible;\n      (_props$onPopupVisible = props.onPopupVisibleChange) === null || _props$onPopupVisible === void 0 || _props$onPopupVisible.call(props, newVisible, ctx);\n    }\n  };\n  var getAutoWidthPopupStyleWidth = function getAutoWidthPopupStyleWidth(triggerElement, popupElement) {\n    var _popupProps$value;\n    return _objectSpread({\n      width: \"\".concat(Math.max(triggerElement.offsetWidth, popupElement.offsetWidth), \"px\")\n    }, (_popupProps$value = popupProps.value) === null || _popupProps$value === void 0 ? void 0 : _popupProps$value.overlayInnerStyle);\n  };\n  var tOverlayInnerStyle = computed(function () {\n    var _popupProps$value2;\n    var result = {};\n    var overlayInnerStyle = ((_popupProps$value2 = popupProps.value) === null || _popupProps$value2 === void 0 ? void 0 : _popupProps$value2.overlayInnerStyle) || {};\n    if (isFunction_1(overlayInnerStyle) || isObject_1(overlayInnerStyle) && overlayInnerStyle.width) {\n      result = overlayInnerStyle;\n    } else {\n      if (autoWidth.value) {\n        result = getAutoWidthPopupStyleWidth;\n      } else {\n        result = matchWidthFunc;\n      }\n    }\n    return result;\n  });\n  return {\n    tOverlayInnerStyle: tOverlayInnerStyle,\n    innerPopupVisible: innerPopupVisible,\n    onInnerPopupVisibleChange: onInnerPopupVisibleChange\n  };\n}\nexport { useOverlayInnerStyle as default };","map":{"version":3,"names":["MAX_POPUP_WIDTH","RESERVE_WIDTH","useOverlayInnerStyle","props","_toRefs","toRefs","popupProps","autoWidth","innerPopupVisible","ref","disable","useFormDisabled","matchWidthFunc","triggerElement","popupElement","SCROLLBAR_WIDTH","scrollHeight","offsetHeight","width","offsetWidth","otherOverlayInnerStyle","value","_typeof","overlayInnerStyle","_objectSpread","concat","Math","min","onInnerPopupVisibleChange","visible","ctx","readonly","newVisible","trigger","allowInput","popupVisible","_props$onPopupVisible","onPopupVisibleChange","call","getAutoWidthPopupStyleWidth","_popupProps$value","max","tOverlayInnerStyle","computed","_popupProps$value2","result","isFunction_1","isObject_1"],"sources":["../../src/select-input/useOverlayInnerStyle.ts"],"sourcesContent":["import { ref, toRefs, computed, CSSProperties } from 'vue';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport { TdSelectInputProps } from './type';\nimport { TdPopupProps, PopupVisibleChangeContext } from '../popup';\nimport { useFormDisabled } from '../form/hooks';\n\nexport type overlayInnerStyleProps = Pick<\n  TdSelectInputProps,\n  'popupProps' | 'autoWidth' | 'readonly' | 'onPopupVisibleChange' | 'disabled' | 'allowInput' | 'popupVisible'\n>;\n\n// 单位：px\nconst MAX_POPUP_WIDTH = 1000;\n// 避免因滚动条出现文本省略，预留宽度 8\nconst RESERVE_WIDTH = 0;\n\nexport default function useOverlayInnerStyle(props: overlayInnerStyleProps) {\n  const { popupProps, autoWidth } = toRefs(props);\n  const innerPopupVisible = ref(false);\n  const disable = useFormDisabled();\n\n  const matchWidthFunc = (triggerElement: HTMLElement, popupElement: HTMLElement) => {\n    const SCROLLBAR_WIDTH = popupElement.scrollHeight > popupElement.offsetHeight ? RESERVE_WIDTH : 0;\n    const width =\n      popupElement.offsetWidth + SCROLLBAR_WIDTH >= triggerElement.offsetWidth\n        ? popupElement.offsetWidth\n        : triggerElement.offsetWidth;\n    let otherOverlayInnerStyle: CSSProperties = {};\n    if (\n      popupProps.value &&\n      typeof popupProps.value.overlayInnerStyle === 'object' &&\n      !popupProps.value.overlayInnerStyle.width\n    ) {\n      otherOverlayInnerStyle = popupProps.value.overlayInnerStyle;\n    }\n    return {\n      width: `${Math.min(width, MAX_POPUP_WIDTH)}px`,\n      ...otherOverlayInnerStyle,\n    };\n  };\n\n  const onInnerPopupVisibleChange = (visible: boolean, ctx: PopupVisibleChangeContext) => {\n    if (disable.value || props.readonly) return;\n    // 如果点击触发元素（输入框）且为可输入状态，则继续显示下拉框\n    const newVisible = ctx.trigger === 'trigger-element-click' && props.allowInput ? true : visible;\n    // 重复点击触发元素时，下拉框展示状态不变，不重复触发事件\n    if (props.popupVisible !== newVisible) {\n      innerPopupVisible.value = newVisible;\n      props.onPopupVisibleChange?.(newVisible, ctx);\n    }\n  };\n\n  const getAutoWidthPopupStyleWidth = (triggerElement: HTMLElement, popupElement: HTMLElement) => {\n    return {\n      width: `${Math.max(triggerElement.offsetWidth, popupElement.offsetWidth)}px`,\n      ...popupProps.value?.overlayInnerStyle,\n    };\n  };\n\n  const tOverlayInnerStyle = computed(() => {\n    let result: TdPopupProps['overlayInnerStyle'] = {};\n    const overlayInnerStyle = popupProps.value?.overlayInnerStyle || {};\n    if (isFunction(overlayInnerStyle) || (isObject(overlayInnerStyle) && overlayInnerStyle.width)) {\n      result = overlayInnerStyle;\n    } else {\n      if (autoWidth.value) {\n        result = getAutoWidthPopupStyleWidth;\n      } else {\n        result = matchWidthFunc;\n      }\n    }\n    return result;\n  });\n\n  return {\n    tOverlayInnerStyle,\n    innerPopupVisible,\n    onInnerPopupVisibleChange,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}