{"ast":null,"code":"/**\n * tdesign v1.9.0\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { _ as _slicedToArray } from '../../_chunks/dep-b089fa1f.mjs';\nimport { toRefs, computed, ref, watchEffect } from 'vue';\nimport { g as getDefaultFormat, d as extractTimeFormat, a as formatTime, p as parseToDayjs, f as formatDate, c as isValidDate } from '../../_chunks/dep-b0329b6c.mjs';\nimport useVModel from '../../hooks/useVModel.mjs';\nimport '../../_chunks/dep-8e411f1c.mjs';\nimport '../../_chunks/dep-30b3f256.mjs';\nimport '../../_chunks/dep-cb814df4.mjs';\nimport '../../_chunks/dep-cd533155.mjs';\nimport '../../_chunks/dep-8dbc9855.mjs';\nimport '../../_chunks/dep-ab439391.mjs';\nimport '../../_chunks/dep-60d62610.mjs';\nimport '../../_chunks/dep-2adf18a2.mjs';\nimport '../../_chunks/dep-bf19d9ba.mjs';\nimport '../../_chunks/dep-7deaa3b9.mjs';\nimport '../../_chunks/dep-66473aa9.mjs';\nimport '../../_chunks/dep-715774e0.mjs';\nimport '../../_chunks/dep-5a5a1764.mjs';\nimport '../../_chunks/dep-bfc3d601.mjs';\nimport '../../_chunks/dep-27be073b.mjs';\nimport '../../_chunks/dep-10024af3.mjs';\nimport '../../_chunks/dep-ec2f76cc.mjs';\nimport '../../_chunks/dep-5db0da5c.mjs';\nimport '../../_chunks/dep-93498383.mjs';\nimport '../../_chunks/dep-013382c3.mjs';\nimport '../../_chunks/dep-3108c312.mjs';\nimport '../../_chunks/dep-2ee9d497.mjs';\nimport '../../_common/js/log/index.mjs';\nimport '../../_common/js/log/log.mjs';\nimport '../../_chunks/dep-bd7cd061.mjs';\nimport '../../_chunks/dep-96484611.mjs';\nimport '../../_chunks/dep-67e59a11.mjs';\nfunction useSingleValue(props) {\n  var _toRefs = toRefs(props),\n    valueFromProps = _toRefs.value,\n    modelValue = _toRefs.modelValue;\n  var _useVModel = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange),\n    _useVModel2 = _slicedToArray(_useVModel, 2),\n    value = _useVModel2[0],\n    onChange = _useVModel2[1];\n  var formatRef = computed(function () {\n    return getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      enableTimePicker: props.enableTimePicker\n    });\n  });\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format)) console.error(\"format: \".concat(formatRef.value.format, \" \\u4E0D\\u89C4\\u8303\\uFF0C\\u5305\\u542B\\u65F6\\u95F4\\u9009\\u62E9\\u5FC5\\u987B\\u8981\\u6709\\u65F6\\u95F4\\u683C\\u5F0F\\u5316 HH:mm:ss\"));\n  }\n  var time = ref(formatTime(value.value, formatRef.value.format, formatRef.value.timeFormat, props.defaultTime));\n  var month = ref(parseToDayjs(value.value, formatRef.value.format).month());\n  var year = ref(parseToDayjs(value.value, formatRef.value.format).year());\n  var cacheValue = ref(formatDate(value.value, {\n    format: formatRef.value.format\n  }));\n  watchEffect(function () {\n    if (!value.value) {\n      cacheValue.value = \"\";\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.format)) return;\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format\n    });\n    time.value = formatTime(value.value, formatRef.value.format, formatRef.value.timeFormat, props.defaultTime);\n  });\n  return {\n    year: year,\n    month: month,\n    value: value,\n    time: time,\n    cacheValue: cacheValue,\n    onChange: onChange\n  };\n}\nexport { useSingleValue as default };","map":{"version":3,"names":["useSingleValue","props","_toRefs","toRefs","valueFromProps","value","modelValue","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","formatRef","computed","getDefaultFormat","mode","format","enableTimePicker","extractTimeFormat","console","error","concat","time","ref","formatTime","timeFormat","defaultTime","month","parseToDayjs","year","cacheValue","formatDate","watchEffect","isValidDate"],"sources":["../../../src/date-picker/hooks/useSingleValue.tsx"],"sourcesContent":["import { toRefs, watchEffect, ref, computed } from 'vue';\nimport {\n  formatDate,\n  formatTime,\n  isValidDate,\n  getDefaultFormat,\n  parseToDayjs,\n} from '../../_common/js/date-picker/format';\nimport useVModel from '../../hooks/useVModel';\nimport { TdDatePickerProps } from '../type';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\n\nexport default function useSingleValue(props: TdDatePickerProps) {\n  const { value: valueFromProps, modelValue } = toRefs(props);\n  const [value, onChange] = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange);\n\n  const formatRef = computed(() =>\n    getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      enableTimePicker: props.enableTimePicker,\n    }),\n  );\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format))\n      console.error(`format: ${formatRef.value.format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  const time = ref(formatTime(value.value, formatRef.value.format, formatRef.value.timeFormat, props.defaultTime));\n  const month = ref<number>(parseToDayjs(value.value, formatRef.value.format).month());\n  const year = ref<number>(parseToDayjs(value.value, formatRef.value.format).year());\n  const cacheValue = ref(formatDate(value.value, { format: formatRef.value.format })); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  watchEffect(() => {\n    if (!value.value) {\n      cacheValue.value = '';\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.format)) return;\n\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format,\n    });\n    time.value = formatTime(value.value, formatRef.value.format, formatRef.value.timeFormat, props.defaultTime);\n  });\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    cacheValue,\n    onChange,\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYA,SAAwBA,eAAeC,KAA0B;EAC/D,IAAAC,OAAA,GAA8CC,MAAA,CAAOF,KAAK;IAA3CG,cAAA,GAAAF,OAAA,CAAPG,KAAO;IAAgBC,UAAW,GAAAJ,OAAA,CAAXI,UAAW;EACpC,IAAAC,UAAA,GAAoBC,SAAA,CAAUJ,cAAA,EAAgBE,UAAY,EAAAL,KAAA,CAAMQ,YAAc,EAAAR,KAAA,CAAMS,QAAQ;IAAAC,WAAA,GAAAC,cAAA,CAAAL,UAAA;IAA3FF,KAAO,GAAAM,WAAA;IAAAD,QAAQ,GAAAC,WAAA;EAEtB,IAAME,SAAY,GAAAC,QAAA,CAAS;IAAA,OACzBC,gBAAiB;MACfC,IAAA,EAAMf,KAAM,CAAAe,IAAA;MACZC,MAAA,EAAQhB,KAAM,CAAAgB,MAAA;MACdC,gBAAA,EAAkBjB,KAAM,CAAAiB;IAC1B,CAAC;EAAA,CACH;EAEA,IAAIjB,KAAA,CAAMiB,gBAAkB;IAC1B,IAAI,CAACC,iBAAA,CAAkBN,SAAU,CAAAR,KAAA,CAAMY,MAAM,GAC3CG,OAAA,CAAQC,KAAM,YAAAC,MAAA,CAAWT,SAAU,CAAAR,KAAA,CAAMY,MAAqC;EAClF;EAEA,IAAMM,IAAO,GAAAC,GAAA,CAAIC,UAAW,CAAApB,KAAA,CAAMA,KAAO,EAAAQ,SAAA,CAAUR,KAAM,CAAAY,MAAA,EAAQJ,SAAU,CAAAR,KAAA,CAAMqB,UAAY,EAAAzB,KAAA,CAAM0B,WAAW,CAAC;EACzG,IAAAC,KAAA,GAAQJ,GAAY,CAAAK,YAAA,CAAaxB,KAAM,CAAAA,KAAA,EAAOQ,SAAA,CAAUR,KAAM,CAAAY,MAAM,CAAE,CAAAW,KAAA,EAAO;EAC7E,IAAAE,IAAA,GAAON,GAAY,CAAAK,YAAA,CAAaxB,KAAM,CAAAA,KAAA,EAAOQ,SAAA,CAAUR,KAAM,CAAAY,MAAM,CAAE,CAAAa,IAAA,EAAM;EAC3E,IAAAC,UAAA,GAAaP,GAAI,CAAAQ,UAAA,CAAW3B,KAAM,CAAAA,KAAA,EAAO;IAAEY,MAAA,EAAQJ,SAAU,CAAAR,KAAA,CAAMY;EAAO,CAAC,CAAC;EAGlFgB,WAAA,CAAY,YAAM;IACZ,KAAC5B,KAAA,CAAMA,KAAO;MAChB0B,UAAA,CAAW1B,KAAQ;MACnB;IACF;IACA,IAAI,CAAC6B,WAAY,CAAA7B,KAAA,CAAMA,KAAO,EAAAQ,SAAA,CAAUR,KAAA,CAAMY,MAAM,GAAG;IAE5Cc,UAAA,CAAA1B,KAAA,GAAQ2B,UAAW,CAAA3B,KAAA,CAAMA,KAAO;MACzCY,MAAA,EAAQJ,SAAA,CAAUR,KAAM,CAAAY;IAC1B,CAAC;IACIM,IAAA,CAAAlB,KAAA,GAAQoB,UAAW,CAAApB,KAAA,CAAMA,KAAO,EAAAQ,SAAA,CAAUR,KAAM,CAAAY,MAAA,EAAQJ,SAAU,CAAAR,KAAA,CAAMqB,UAAY,EAAAzB,KAAA,CAAM0B,WAAW;EAC5G,CAAC;EAEM;IACLG,IAAA,EAAAA,IAAA;IACAF,KAAA,EAAAA,KAAA;IACAvB,KAAA,EAAAA,KAAA;IACAkB,IAAA,EAAAA,IAAA;IACAQ,UAAA,EAAAA,UAAA;IACArB,QAAA,EAAAA;GACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}