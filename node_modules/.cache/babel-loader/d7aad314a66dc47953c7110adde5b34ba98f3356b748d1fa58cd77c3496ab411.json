{"ast":null,"code":"/**\n * tdesign v1.9.0\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { _ as _slicedToArray } from '../../_chunks/dep-b089fa1f.mjs';\nimport { toRefs, computed, ref, watchEffect } from 'vue';\nimport useVModel from '../../hooks/useVModel.mjs';\nimport { i as isArray_1 } from '../../_chunks/dep-ab439391.mjs';\nimport { g as getDefaultFormat, d as extractTimeFormat, c as isValidDate, i as initYearMonthTime, f as formatDate, a as formatTime } from '../../_chunks/dep-b0329b6c.mjs';\nimport '../../_chunks/dep-8e411f1c.mjs';\nimport '../../_chunks/dep-bd7cd061.mjs';\nimport '../../_chunks/dep-cb814df4.mjs';\nimport '../../_chunks/dep-96484611.mjs';\nimport '../../_chunks/dep-67e59a11.mjs';\nimport '../../_chunks/dep-cd533155.mjs';\nimport '../../_chunks/dep-8dbc9855.mjs';\nimport '../../_chunks/dep-60d62610.mjs';\nimport '../../_chunks/dep-10024af3.mjs';\nimport '../../_chunks/dep-2adf18a2.mjs';\nimport '../../_chunks/dep-30b3f256.mjs';\nimport '../../_chunks/dep-bf19d9ba.mjs';\nimport '../../_chunks/dep-7deaa3b9.mjs';\nimport '../../_chunks/dep-66473aa9.mjs';\nimport '../../_chunks/dep-715774e0.mjs';\nimport '../../_chunks/dep-5a5a1764.mjs';\nimport '../../_chunks/dep-bfc3d601.mjs';\nimport '../../_chunks/dep-27be073b.mjs';\nimport '../../_chunks/dep-ec2f76cc.mjs';\nimport '../../_chunks/dep-5db0da5c.mjs';\nimport '../../_chunks/dep-93498383.mjs';\nimport '../../_chunks/dep-013382c3.mjs';\nimport '../../_chunks/dep-3108c312.mjs';\nimport '../../_chunks/dep-2ee9d497.mjs';\nimport '../../_common/js/log/index.mjs';\nimport '../../_common/js/log/log.mjs';\nvar PARTIAL_MAP = {\n  first: \"start\",\n  second: \"end\"\n};\nfunction useRangeValue(props) {\n  var _toRefs = toRefs(props),\n    valueFromProps = _toRefs.value,\n    modelValue = _toRefs.modelValue;\n  var _useVModel = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange),\n    _useVModel2 = _slicedToArray(_useVModel, 2),\n    value = _useVModel2[0],\n    onChange = _useVModel2[1];\n  var formatRef = computed(function () {\n    return getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      enableTimePicker: props.enableTimePicker\n    });\n  });\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format)) console.error(\"format: \".concat(formatRef.value.format, \" \\u4E0D\\u89C4\\u8303\\uFF0C\\u5305\\u542B\\u65F6\\u95F4\\u9009\\u62E9\\u5FC5\\u987B\\u8981\\u6709\\u65F6\\u95F4\\u683C\\u5F0F\\u5316 HH:mm:ss\"));\n  }\n  if (!isArray_1(value.value)) {\n    console.error(\"typeof value: \".concat(value.value, \" must be Array!\"));\n  } else if (!isValidDate(value.value, formatRef.value.format)) {\n    console.error(\"value: \".concat(value.value, \" is invalid dateTime! Check whether the value is consistent with format: \").concat(formatRef.value.format));\n  }\n  var isFirstValueSelected = ref(false);\n  var time = ref(initYearMonthTime({\n    value: value.value,\n    mode: props.mode,\n    format: formatRef.value.format,\n    timeFormat: formatRef.value.timeFormat\n  }).time);\n  var month = ref(initYearMonthTime({\n    value: value.value,\n    mode: props.mode,\n    format: formatRef.value.format,\n    enableTimePicker: props.enableTimePicker\n  }).month);\n  var year = ref(initYearMonthTime({\n    value: value.value,\n    mode: props.mode,\n    format: formatRef.value.format\n  }).year);\n  var cacheValue = ref(formatDate(value.value, {\n    format: formatRef.value.format\n  }));\n  watchEffect(function () {\n    if (!value.value) {\n      cacheValue.value = [];\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.format)) return;\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format\n    });\n    time.value = formatTime(value.value, formatRef.value.format, formatRef.value.timeFormat, props.defaultTime);\n  });\n  return {\n    year: year,\n    month: month,\n    value: value,\n    time: time,\n    isFirstValueSelected: isFirstValueSelected,\n    cacheValue: cacheValue,\n    onChange: onChange\n  };\n}\nexport { PARTIAL_MAP, useRangeValue as default };","map":{"version":3,"names":["PARTIAL_MAP","first","second","useRangeValue","props","_toRefs","toRefs","valueFromProps","value","modelValue","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","formatRef","computed","getDefaultFormat","mode","format","enableTimePicker","extractTimeFormat","console","error","concat","isArray_1","isValidDate","isFirstValueSelected","ref","time","initYearMonthTime","timeFormat","month","year","cacheValue","formatDate","watchEffect","formatTime","defaultTime"],"sources":["../../../src/date-picker/hooks/useRangeValue.ts"],"sourcesContent":["import { ref, toRefs, watchEffect, computed } from 'vue';\nimport useVModel from '../../hooks/useVModel';\nimport isArray from 'lodash/isArray';\n\nimport { TdDateRangePickerProps } from '../type';\nimport {\n  isValidDate,\n  formatDate,\n  formatTime,\n  getDefaultFormat,\n  initYearMonthTime,\n} from '../../_common/js/date-picker/format';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\n\nexport const PARTIAL_MAP = { first: 'start', second: 'end' };\n\nexport default function useRangeValue(props: TdDateRangePickerProps) {\n  const { value: valueFromProps, modelValue } = toRefs(props);\n\n  const [value, onChange] = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange);\n\n  const formatRef = computed(() =>\n    getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      enableTimePicker: props.enableTimePicker,\n    }),\n  );\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format))\n      console.error(`format: ${formatRef.value.format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  // warning invalid value\n  if (!isArray(value.value)) {\n    console.error(`typeof value: ${value.value} must be Array!`);\n  } else if (!isValidDate(value.value, formatRef.value.format)) {\n    console.error(\n      `value: ${value.value} is invalid dateTime! Check whether the value is consistent with format: ${formatRef.value.format}`,\n    );\n  }\n\n  const isFirstValueSelected = ref(false); // 记录面板点击次数，两次后才自动关闭\n  const time = ref(\n    initYearMonthTime({\n      value: value.value,\n      mode: props.mode,\n      format: formatRef.value.format,\n      timeFormat: formatRef.value.timeFormat,\n    }).time,\n  );\n  const month = ref(\n    initYearMonthTime({\n      value: value.value,\n      mode: props.mode,\n      format: formatRef.value.format,\n      enableTimePicker: props.enableTimePicker,\n    }).month,\n  );\n  const year = ref(initYearMonthTime({ value: value.value, mode: props.mode, format: formatRef.value.format }).year);\n  const cacheValue = ref(formatDate(value.value, { format: formatRef.value.format })); // 选择阶段预选状态\n\n  // 输入框响应 value 变化\n  watchEffect(() => {\n    if (!value.value) {\n      cacheValue.value = [];\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.format)) return;\n\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format,\n    });\n    time.value = formatTime(\n      value.value,\n      formatRef.value.format,\n      formatRef.value.timeFormat,\n      props.defaultTime,\n    ) as string[];\n  });\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    isFirstValueSelected,\n    cacheValue,\n    onChange,\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcO,IAAMA,WAAc;EAAEC,KAAO;EAASC,MAAA,EAAQ;AAAM;AAE3D,SAAwBC,cAAcC,KAA+B;EACnE,IAAAC,OAAA,GAA8CC,MAAA,CAAOF,KAAK;IAA3CG,cAAA,GAAAF,OAAA,CAAPG,KAAO;IAAgBC,UAAW,GAAAJ,OAAA,CAAXI,UAAW;EAEpC,IAAAC,UAAA,GAAoBC,SAAA,CAAUJ,cAAA,EAAgBE,UAAY,EAAAL,KAAA,CAAMQ,YAAc,EAAAR,KAAA,CAAMS,QAAQ;IAAAC,WAAA,GAAAC,cAAA,CAAAL,UAAA;IAA3FF,KAAO,GAAAM,WAAA;IAAAD,QAAQ,GAAAC,WAAA;EAEtB,IAAME,SAAY,GAAAC,QAAA,CAAS;IAAA,OACzBC,gBAAiB;MACfC,IAAA,EAAMf,KAAM,CAAAe,IAAA;MACZC,MAAA,EAAQhB,KAAM,CAAAgB,MAAA;MACdC,gBAAA,EAAkBjB,KAAM,CAAAiB;IAC1B,CAAC;EAAA,CACH;EAEA,IAAIjB,KAAA,CAAMiB,gBAAkB;IAC1B,IAAI,CAACC,iBAAA,CAAkBN,SAAU,CAAAR,KAAA,CAAMY,MAAM,GAC3CG,OAAA,CAAQC,KAAM,YAAAC,MAAA,CAAWT,SAAU,CAAAR,KAAA,CAAMY,MAAqC;EAClF;EAGA,IAAI,CAACM,SAAA,CAAQlB,KAAM,CAAAA,KAAK,CAAG;IACjBe,OAAA,CAAAC,KAAA,kBAAAC,MAAA,CAAuBjB,KAAA,CAAMA,KAAsB;EAC7D,WAAW,CAACmB,WAAY,CAAAnB,KAAA,CAAMA,KAAA,EAAOQ,SAAU,CAAAR,KAAA,CAAMY,MAAM,CAAG;IACpDG,OAAA,CAAAC,KAAA,WAAAC,MAAA,CACIjB,KAAA,CAAMA,KAAiF,+EAAAiB,MAAA,CAAAT,SAAA,CAAUR,KAAM,CAAAY,MAAA,CACnH;EACF;EAEM,IAAAQ,oBAAA,GAAuBC,GAAA,CAAI,KAAK;EACtC,IAAMC,IAAO,GAAAD,GAAA,CACXE,iBAAkB;IAChBvB,KAAA,EAAOA,KAAM,CAAAA,KAAA;IACbW,IAAA,EAAMf,KAAM,CAAAe,IAAA;IACZC,MAAA,EAAQJ,SAAA,CAAUR,KAAM,CAAAY,MAAA;IACxBY,UAAA,EAAYhB,SAAA,CAAUR,KAAM,CAAAwB;GAC7B,CAAE,CAAAF,IACL;EACA,IAAMG,KAAQ,GAAAJ,GAAA,CACZE,iBAAkB;IAChBvB,KAAA,EAAOA,KAAM,CAAAA,KAAA;IACbW,IAAA,EAAMf,KAAM,CAAAe,IAAA;IACZC,MAAA,EAAQJ,SAAA,CAAUR,KAAM,CAAAY,MAAA;IACxBC,gBAAA,EAAkBjB,KAAM,CAAAiB;GACzB,CAAE,CAAAY,KACL;EACA,IAAMC,IAAA,GAAOL,GAAI,CAAAE,iBAAA,CAAkB;IAAEvB,KAAA,EAAOA,KAAA,CAAMA,KAAO;IAAAW,IAAA,EAAMf,KAAM,CAAAe,IAAA;IAAMC,MAAA,EAAQJ,SAAU,CAAAR,KAAA,CAAMY;GAAQ,EAAEc,IAAI;EAC3G,IAAAC,UAAA,GAAaN,GAAI,CAAAO,UAAA,CAAW5B,KAAM,CAAAA,KAAA,EAAO;IAAEY,MAAA,EAAQJ,SAAU,CAAAR,KAAA,CAAMY;EAAO,CAAC,CAAC;EAGlFiB,WAAA,CAAY,YAAM;IACZ,KAAC7B,KAAA,CAAMA,KAAO;MAChB2B,UAAA,CAAW3B,KAAA,GAAQ,EAAC;MACpB;IACF;IACA,IAAI,CAACmB,WAAY,CAAAnB,KAAA,CAAMA,KAAO,EAAAQ,SAAA,CAAUR,KAAA,CAAMY,MAAM,GAAG;IAE5Ce,UAAA,CAAA3B,KAAA,GAAQ4B,UAAW,CAAA5B,KAAA,CAAMA,KAAO;MACzCY,MAAA,EAAQJ,SAAA,CAAUR,KAAM,CAAAY;IAC1B,CAAC;IACDU,IAAA,CAAKtB,KAAQ,GAAA8B,UAAA,CACX9B,KAAM,CAAAA,KAAA,EACNQ,SAAA,CAAUR,KAAM,CAAAY,MAAA,EAChBJ,SAAA,CAAUR,KAAM,CAAAwB,UAAA,EAChB5B,KAAM,CAAAmC,WACR;EACF,CAAC;EAEM;IACLL,IAAA,EAAAA,IAAA;IACAD,KAAA,EAAAA,KAAA;IACAzB,KAAA,EAAAA,KAAA;IACAsB,IAAA,EAAAA,IAAA;IACAF,oBAAA,EAAAA,oBAAA;IACAO,UAAA,EAAAA,UAAA;IACAtB,QAAA,EAAAA;GACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}