{"ast":null,"code":"/**\n * tdesign v1.9.0\n * (c) 2024 tdesign\n * @license MIT\n */\n\nimport { defineComponent, toRefs, ref, computed, watch, createVNode } from 'vue';\nimport { ImageErrorIcon } from 'tdesign-icons-vue-next';\nimport { usePrefixClass } from '../../hooks/useConfig.mjs';\nimport { useDrag } from '../hooks.mjs';\nimport { useImagePreviewUrl } from '../../hooks/useImagePreviewUrl.mjs';\nimport { useConfig } from '../../config-provider/useConfig.mjs';\nimport '../../_chunks/dep-66473aa9.mjs';\nimport '../../_chunks/dep-cb814df4.mjs';\nimport '../../_chunks/dep-cd533155.mjs';\nimport '../../_chunks/dep-8dbc9855.mjs';\nimport '../../_chunks/dep-715774e0.mjs';\nimport '../../_chunks/dep-5a5a1764.mjs';\nimport '../../_chunks/dep-37e3e644.mjs';\nimport '../../_chunks/dep-31dc0415.mjs';\nimport '../../_chunks/dep-e5142249.mjs';\nimport '../../_chunks/dep-c4f80cb4.mjs';\nimport '../../_chunks/dep-996b4900.mjs';\nimport '../../_chunks/dep-3108c312.mjs';\nimport '../../_chunks/dep-93498383.mjs';\nimport '../../_chunks/dep-36582a92.mjs';\nimport '../../_chunks/dep-a2db6df1.mjs';\nimport '../../_chunks/dep-0f89a1dd.mjs';\nimport '../../_chunks/dep-2adf18a2.mjs';\nimport '../../_chunks/dep-ab439391.mjs';\nimport '../../_chunks/dep-60d62610.mjs';\nimport '../../_chunks/dep-d4da440a.mjs';\nimport '../../_chunks/dep-013382c3.mjs';\nimport '../../_chunks/dep-ca764006.mjs';\nimport '../../_chunks/dep-2ee9d497.mjs';\nimport '../../_chunks/dep-c545db54.mjs';\nimport '../../_chunks/dep-3f15cb30.mjs';\nimport '../../_chunks/dep-fd2b6c64.mjs';\nimport '../../_chunks/dep-30b3f256.mjs';\nimport '../../_chunks/dep-b3734774.mjs';\nimport '../../_chunks/dep-a4a3ac25.mjs';\nimport '../../_chunks/dep-6861d388.mjs';\nimport '../../_chunks/dep-396d852b.mjs';\nimport '../../_chunks/dep-8a3fd140.mjs';\nimport '../../_chunks/dep-5db0da5c.mjs';\nimport '../../_common/js/global-config/default-config.mjs';\nimport '../../_common/js/global-config/locale/zh_CN.mjs';\nimport '../../_chunks/dep-bf19d9ba.mjs';\nimport '../../_chunks/dep-6963a882.mjs';\nimport '../../config-provider/type.mjs';\nimport '../../_chunks/dep-7deaa3b9.mjs';\nimport '../../_common/js/input-number/number.mjs';\nimport '../../_chunks/dep-ac561548.mjs';\nimport '../../_chunks/dep-0e4de31a.mjs';\nimport '../../_common/js/input-number/large-number.mjs';\nimport '../../_chunks/dep-b089fa1f.mjs';\nimport '../../_chunks/dep-8e411f1c.mjs';\nimport '../../_common/js/log/log.mjs';\nimport '../../_common/js/log/index.mjs';\nimport '../../_common/js/upload/utils.mjs';\nvar TImageItem = defineComponent({\n  name: \"TImageItem\",\n  props: {\n    rotate: Number,\n    scale: Number,\n    mirror: Number,\n    src: [String, Object],\n    placementSrc: [String, Object]\n  },\n  setup: function setup(props) {\n    var _toRefs = toRefs(props),\n      src = _toRefs.src,\n      placementSrc = _toRefs.placementSrc;\n    var classPrefix = usePrefixClass();\n    var error = ref(false);\n    var loaded = ref(false);\n    var _useDrag = useDrag({\n        translateX: 0,\n        translateY: 0\n      }),\n      transform = _useDrag.transform,\n      mouseDownHandler = _useDrag.mouseDownHandler;\n    var _useConfig = useConfig(\"imageViewer\"),\n      globalConfig = _useConfig.globalConfig;\n    var errorText = globalConfig.value.errorText;\n    var imgStyle = computed(function () {\n      return {\n        transform: \"rotate(\".concat(props.rotate, \"deg) scale(\").concat(props.scale, \")\"),\n        display: !props.placementSrc || loaded.value ? \"block\" : \"none\"\n      };\n    });\n    var placementImgStyle = computed(function () {\n      return {\n        transform: \"rotate(\".concat(props.rotate, \"deg) scale(\").concat(props.scale, \")\"),\n        display: !loaded.value ? \"block\" : \"none\"\n      };\n    });\n    var boxStyle = computed(function () {\n      var _transform$value = transform.value,\n        translateX = _transform$value.translateX,\n        translateY = _transform$value.translateY;\n      return {\n        transform: \"translate(\".concat(translateX, \"px, \").concat(translateY, \"px) scale(\").concat(props.mirror, \", 1)\")\n      };\n    });\n    var resetStatus = function resetStatus() {\n      error.value = false;\n      loaded.value = false;\n    };\n    var _useImagePreviewUrl = useImagePreviewUrl(src),\n      mainImagePreviewUrl = _useImagePreviewUrl.previewUrl;\n    var _useImagePreviewUrl2 = useImagePreviewUrl(placementSrc),\n      placementImagePreviewUrl = _useImagePreviewUrl2.previewUrl;\n    watch([mainImagePreviewUrl, placementImagePreviewUrl], function () {\n      resetStatus();\n    });\n    return function () {\n      return createVNode(\"div\", {\n        \"class\": \"\".concat(classPrefix.value, \"-image-viewer__modal-pic\")\n      }, [createVNode(\"div\", {\n        \"class\": \"\".concat(classPrefix.value, \"-image-viewer__modal-box\"),\n        \"style\": boxStyle.value\n      }, [error.value && createVNode(\"div\", {\n        \"class\": \"\".concat(classPrefix.value, \"-image-viewer__img-error\")\n      }, [createVNode(\"div\", {\n        \"class\": \"\".concat(classPrefix.value, \"-image-viewer__img-error-content\")\n      }, [createVNode(ImageErrorIcon, {\n        \"size\": \"4em\"\n      }, null), createVNode(\"div\", {\n        \"class\": \"\".concat(classPrefix.value, \"-image-viewer__img-error-text\")\n      }, [errorText])])]), !error.value && !!props.placementSrc && placementImagePreviewUrl.value && createVNode(\"img\", {\n        \"class\": \"\".concat(classPrefix.value, \"-image-viewer__modal-image\"),\n        \"onMousedown\": function onMousedown(event) {\n          event.stopPropagation();\n          mouseDownHandler(event);\n        },\n        \"src\": placementImagePreviewUrl.value,\n        \"style\": placementImgStyle.value,\n        \"alt\": \"image\",\n        \"draggable\": \"false\"\n      }, null), !error.value && mainImagePreviewUrl.value && createVNode(\"img\", {\n        \"class\": \"\".concat(classPrefix.value, \"-image-viewer__modal-image\"),\n        \"onMousedown\": function onMousedown(event) {\n          event.stopPropagation();\n          mouseDownHandler(event);\n        },\n        \"src\": mainImagePreviewUrl.value,\n        \"onLoad\": function onLoad() {\n          return loaded.value = true;\n        },\n        \"onError\": function onError() {\n          return error.value = true;\n        },\n        \"style\": imgStyle.value,\n        \"alt\": \"image\",\n        \"draggable\": \"false\"\n      }, null)])]);\n    };\n  }\n});\nexport { TImageItem as default };","map":{"version":3,"names":["TImageItem","defineComponent","name","props","rotate","Number","scale","mirror","src","String","Object","placementSrc","setup","_toRefs","toRefs","classPrefix","usePrefixClass","error","ref","loaded","_useDrag","useDrag","translateX","translateY","transform","mouseDownHandler","_useConfig","useConfig","globalConfig","errorText","value","imgStyle","computed","concat","display","placementImgStyle","boxStyle","_transform$value","resetStatus","_useImagePreviewUrl","useImagePreviewUrl","mainImagePreviewUrl","previewUrl","_useImagePreviewUrl2","placementImagePreviewUrl","watch","createVNode","ImageErrorIcon","onMousedown","event","stopPropagation","onLoad","onError"],"sources":["../../../src/image-viewer/base/ImageItem.tsx"],"sourcesContent":["import { computed, defineComponent, PropType, ref, toRefs, watch } from 'vue';\nimport { ImageErrorIcon } from 'tdesign-icons-vue-next';\nimport { usePrefixClass, useConfig } from '../../hooks/useConfig';\nimport { useDrag } from '../hooks';\nimport { useImagePreviewUrl } from '../../hooks/useImagePreviewUrl';\n\nexport default defineComponent({\n  name: 'TImageItem',\n  props: {\n    rotate: Number,\n    scale: Number,\n    mirror: Number,\n    src: [String, Object] as PropType<string | File>,\n    placementSrc: [String, Object] as PropType<string | File>,\n  },\n\n  setup(props) {\n    const { src, placementSrc } = toRefs(props);\n    const classPrefix = usePrefixClass();\n    const error = ref(false);\n    const loaded = ref(false);\n    const { transform, mouseDownHandler } = useDrag({ translateX: 0, translateY: 0 });\n    const { globalConfig } = useConfig('imageViewer');\n    const errorText = globalConfig.value.errorText;\n\n    const imgStyle = computed(() => ({\n      transform: `rotate(${props.rotate}deg) scale(${props.scale})`,\n      display: !props.placementSrc || loaded.value ? 'block' : 'none',\n    }));\n    const placementImgStyle = computed(() => ({\n      transform: `rotate(${props.rotate}deg) scale(${props.scale})`,\n      display: !loaded.value ? 'block' : 'none',\n    }));\n    const boxStyle = computed(() => {\n      const { translateX, translateY } = transform.value;\n      return {\n        transform: `translate(${translateX}px, ${translateY}px) scale(${props.mirror}, 1)`,\n      };\n    });\n\n    const resetStatus = () => {\n      error.value = false;\n      loaded.value = false;\n    };\n\n    const { previewUrl: mainImagePreviewUrl } = useImagePreviewUrl(src);\n    const { previewUrl: placementImagePreviewUrl } = useImagePreviewUrl(placementSrc);\n\n    watch([mainImagePreviewUrl, placementImagePreviewUrl], () => {\n      resetStatus();\n    });\n\n    return () => (\n      <div class={`${classPrefix.value}-image-viewer__modal-pic`}>\n        <div class={`${classPrefix.value}-image-viewer__modal-box`} style={boxStyle.value}>\n          {error.value && (\n            <div class={`${classPrefix.value}-image-viewer__img-error`}>\n              {/* 脱离文档流 */}\n              <div class={`${classPrefix.value}-image-viewer__img-error-content`}>\n                <ImageErrorIcon size=\"4em\" />\n                <div class={`${classPrefix.value}-image-viewer__img-error-text`}>{errorText}</div>\n              </div>\n            </div>\n          )}\n\n          {!error.value && !!props.placementSrc && placementImagePreviewUrl.value && (\n            <img\n              class={`${classPrefix.value}-image-viewer__modal-image`}\n              onMousedown={(event: MouseEvent) => {\n                event.stopPropagation();\n                mouseDownHandler(event);\n              }}\n              src={placementImagePreviewUrl.value}\n              style={placementImgStyle.value}\n              alt=\"image\"\n              draggable=\"false\"\n            />\n          )}\n\n          {!error.value && mainImagePreviewUrl.value && (\n            <img\n              class={`${classPrefix.value}-image-viewer__modal-image`}\n              onMousedown={(event: MouseEvent) => {\n                event.stopPropagation();\n                mouseDownHandler(event);\n              }}\n              src={mainImagePreviewUrl.value}\n              onLoad={() => (loaded.value = true)}\n              onError={() => (error.value = true)}\n              style={imgStyle.value}\n              alt=\"image\"\n              draggable=\"false\"\n            />\n          )}\n        </div>\n      </div>\n    );\n  },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}